<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: DL::Importable::Internal</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">DL::Importable::Internal</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/dl/lib/dl/struct_rb.html">
                dl/lib/dl/struct.rb
                </a>
        <br />
                <a href="../../../files/dl/lib/dl/import_rb.html">
                dl/lib/dl/import.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000476">[]</a>&nbsp;&nbsp;
      <a href="#M000485">_args_</a>&nbsp;&nbsp;
      <a href="#M000486">_retval_</a>&nbsp;&nbsp;
      <a href="#M000481">callback</a>&nbsp;&nbsp;
      <a href="#M000470">define_struct</a>&nbsp;&nbsp;
      <a href="#M000472">define_union</a>&nbsp;&nbsp;
      <a href="#M000478">dllink</a>&nbsp;&nbsp;
      <a href="#M000477">dlload</a>&nbsp;&nbsp;
      <a href="#M000487">encode_argument_types</a>&nbsp;&nbsp;
      <a href="#M000480">extern</a>&nbsp;&nbsp;
      <a href="#M000484">import</a>&nbsp;&nbsp;
      <a href="#M000475">init_sym</a>&nbsp;&nbsp;
      <a href="#M000474">init_types</a>&nbsp;&nbsp;
      <a href="#M000479">parse_cproto</a>&nbsp;&nbsp;
      <a href="#M000471">struct</a>&nbsp;&nbsp;
      <a href="#M000483">symbol</a>&nbsp;&nbsp;
      <a href="#M000482">typealias</a>&nbsp;&nbsp;
      <a href="#M000473">union</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="Internal/Memory.html" class="link">DL::Importable::Internal::Memory</a><br />
Class <a href="Internal/Struct.html" class="link">DL::Importable::Internal::Struct</a><br />
Class <a href="Internal/Union.html" class="link">DL::Importable::Internal::Union</a><br />

    </div>




      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000476" class="m-detail">
        <a name="M000476"></a>

        <div class="method-heading">
          <a href="#M000476" class="method-signature">
          <span class="method-name">[]</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="m-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000476-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000476-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 19</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-identifier">name</span>)
        <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@SYM</span>[<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>][<span class="ruby-value">0</span>]
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000485" class="m-detail">
        <a name="M000485"></a>

        <div class="method-heading">
          <a href="#M000485" class="method-signature">
          <span class="method-name">_args_</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="m-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000485-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000485-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 180</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_args_</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@args</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000486" class="m-detail">
        <a name="M000486"></a>

        <div class="method-heading">
          <a href="#M000486" class="method-signature">
          <span class="method-name">_retval_</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="m-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000486-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000486-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 184</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_retval_</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@retval</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000481" class="m-detail">
        <a name="M000481"></a>

        <div class="method-heading">
          <a href="#M000481" class="method-signature">
          <span class="method-name">callback</span><span class="method-args">(proto)</span>
          </a>
        </div>
      
        <div class="m-description">
          <p>
example:
</p>
<pre>
  callback &quot;int method_name(int, char*)&quot;
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000481-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000481-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 67</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">callback</span>(<span class="ruby-identifier">proto</span>)
        <span class="ruby-identifier">func</span>,<span class="ruby-identifier">ret</span>,<span class="ruby-identifier">args</span> = <span class="ruby-identifier">parse_cproto</span>(<span class="ruby-identifier">proto</span>)

        <span class="ruby-identifier">init_types</span>()
        <span class="ruby-identifier">init_sym</span>()

        <span class="ruby-identifier">rty</span>,<span class="ruby-identifier">renc</span>,<span class="ruby-identifier">rdec</span> = <span class="ruby-ivar">@types</span>.<span class="ruby-identifier">encode_return_type</span>(<span class="ruby-identifier">ret</span>)
        <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">rty</span> )
          <span class="ruby-identifier">raise</span>(<span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;unsupported type: #{ret}&quot;</span>)
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">ty</span>,<span class="ruby-identifier">enc</span>,<span class="ruby-identifier">dec</span> = <span class="ruby-identifier">encode_argument_types</span>(<span class="ruby-identifier">args</span>)
        <span class="ruby-identifier">symty</span> = <span class="ruby-identifier">rty</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ty</span>

        <span class="ruby-identifier">module_eval</span>(<span class="ruby-node">&quot;module_function :#{func}&quot;</span>)
        <span class="ruby-identifier">sym</span> = <span class="ruby-identifier">module_eval</span>([
          <span class="ruby-node">&quot;DL::callback(\&quot;#{symty}\&quot;){|*args|&quot;</span>,
          <span class="ruby-node">&quot;  sym,rdec,enc,dec  = @SYM['#{func}']&quot;</span>,
          <span class="ruby-value str">&quot;  args = enc.call(args) if enc&quot;</span>,
          <span class="ruby-node">&quot;  r,rs = #{func}(*args)&quot;</span>,
          <span class="ruby-value str">&quot;  r  = renc.call(r) if rdec&quot;</span>,
          <span class="ruby-value str">&quot;  rs = dec.call(rs) if (dec &amp;&amp; rs)&quot;</span>,
          <span class="ruby-value str">&quot;  @retval = r&quot;</span>,
          <span class="ruby-value str">&quot;  @args   = rs&quot;</span>,
          <span class="ruby-value str">&quot;  r&quot;</span>,
          <span class="ruby-value str">&quot;}&quot;</span>,
        ].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>))

        <span class="ruby-ivar">@SYM</span>[<span class="ruby-identifier">func</span>] = [<span class="ruby-identifier">sym</span>,<span class="ruby-identifier">rdec</span>,<span class="ruby-identifier">enc</span>,<span class="ruby-identifier">dec</span>]

        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sym</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000470" class="m-detail">
        <a name="M000470"></a>

        <div class="method-heading">
          <a href="#M000470" class="method-signature">
          <span class="method-name">define_struct</span><span class="method-args">(contents)</span>
          </a>
        </div>
      
        <div class="m-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000470-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000470-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/struct.rb, line 9</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_struct</span>(<span class="ruby-identifier">contents</span>)
        <span class="ruby-identifier">init_types</span>()
        <span class="ruby-constant">Struct</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@types</span>, <span class="ruby-identifier">contents</span>)
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000472" class="m-detail">
        <a name="M000472"></a>

        <div class="method-heading">
          <a href="#M000472" class="method-signature">
          <span class="method-name">define_union</span><span class="method-args">(contents)</span>
          </a>
        </div>
      
        <div class="m-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000472-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000472-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/struct.rb, line 15</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_union</span>(<span class="ruby-identifier">contents</span>)
        <span class="ruby-identifier">init_types</span>()
        <span class="ruby-constant">Union</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@types</span>, <span class="ruby-identifier">contents</span>)
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000478" class="m-detail">
        <a name="M000478"></a>

        <div class="method-heading">
          <span class="method-name">dllink</span><span class="method-args">(*libnames)</span>
        </div>
      
        <div class="m-description">
          <p>
Alias for <a href="Internal.html#M000477">dlload</a>
</p>
        </div>
      </div>

      <div id="method-M000477" class="m-detail">
        <a name="M000477"></a>

        <div class="method-heading">
          <a href="#M000477" class="method-signature">
          <span class="method-name">dlload</span><span class="method-args">(*libnames)</span>
          </a>
        </div>
      
        <div class="m-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000477-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000477-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 23</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dlload</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">libnames</span>)
        <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@LIBS</span>) )
          <span class="ruby-ivar">@LIBS</span> = []
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">libnames</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">libname</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-constant">LIB_MAP</span>[<span class="ruby-identifier">libname</span>] )
            <span class="ruby-constant">LIB_MAP</span>[<span class="ruby-identifier">libname</span>] = <span class="ruby-constant">DL</span>.<span class="ruby-identifier">dlopen</span>(<span class="ruby-identifier">libname</span>)
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-ivar">@LIBS</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">LIB_MAP</span>[<span class="ruby-identifier">libname</span>])
        }
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000487" class="m-detail">
        <a name="M000487"></a>

        <div class="method-heading">
          <a href="#M000487" class="method-signature">
          <span class="method-name">encode_argument_types</span><span class="method-args">(tys)</span>
          </a>
        </div>
      
        <div class="m-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000487-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000487-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 188</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_argument_types</span>(<span class="ruby-identifier">tys</span>)
        <span class="ruby-identifier">init_types</span>()
        <span class="ruby-identifier">encty</span> = []
        <span class="ruby-identifier">enc</span> = <span class="ruby-keyword kw">nil</span>
        <span class="ruby-identifier">dec</span> = <span class="ruby-keyword kw">nil</span>
        <span class="ruby-identifier">tys</span>.<span class="ruby-identifier">each_with_index</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">ty</span>,<span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">ty</span>,<span class="ruby-identifier">c1</span>,<span class="ruby-identifier">c2</span> = <span class="ruby-ivar">@types</span>.<span class="ruby-identifier">encode_argument_type</span>(<span class="ruby-identifier">ty</span>)
          <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">ty</span> )
            <span class="ruby-identifier">raise</span>(<span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;unsupported type: #{ty}&quot;</span>)
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-identifier">encty</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">ty</span>)
          <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">enc</span> )
            <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">c1</span> )
              <span class="ruby-identifier">conv1</span> = <span class="ruby-identifier">enc</span>
              <span class="ruby-identifier">enc</span> = <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> = <span class="ruby-identifier">conv1</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>); <span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>] = <span class="ruby-identifier">c1</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>]); <span class="ruby-identifier">v</span>}
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">c1</span> )
              <span class="ruby-identifier">enc</span> = <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>] = <span class="ruby-identifier">c1</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>]); <span class="ruby-identifier">v</span>}
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">dec</span> )
            <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">c2</span> )
              <span class="ruby-identifier">conv2</span> = <span class="ruby-identifier">dec</span>
              <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> = <span class="ruby-identifier">conv2</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>); <span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>] = <span class="ruby-identifier">c2</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>]); <span class="ruby-identifier">v</span>}
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">c2</span> )
              <span class="ruby-identifier">dec</span> = <span class="ruby-identifier">proc</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>] = <span class="ruby-identifier">c2</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">v</span>[<span class="ruby-identifier">idx</span>]); <span class="ruby-identifier">v</span>}
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">end</span>
        }
        <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">encty</span>.<span class="ruby-identifier">join</span>, <span class="ruby-identifier">enc</span>, <span class="ruby-identifier">dec</span>]
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000480" class="m-detail">
        <a name="M000480"></a>

        <div class="method-heading">
          <a href="#M000480" class="method-signature">
          <span class="method-name">extern</span><span class="method-args">(proto)</span>
          </a>
        </div>
      
        <div class="m-description">
          <p>
example:
</p>
<pre>
  extern &quot;int strlen(char*)&quot;
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000480-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000480-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 59</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extern</span>(<span class="ruby-identifier">proto</span>)
        <span class="ruby-identifier">func</span>,<span class="ruby-identifier">ret</span>,<span class="ruby-identifier">args</span> = <span class="ruby-identifier">parse_cproto</span>(<span class="ruby-identifier">proto</span>)
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">import</span>(<span class="ruby-identifier">func</span>, <span class="ruby-identifier">ret</span>, <span class="ruby-identifier">args</span>)
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000484" class="m-detail">
        <a name="M000484"></a>

        <div class="method-heading">
          <a href="#M000484" class="method-signature">
          <span class="method-name">import</span><span class="method-args">(name, rettype, argtypes = nil)</span>
          </a>
        </div>
      
        <div class="m-description">
          <p>
example:
</p>
<pre>
  import(&quot;get_length&quot;, &quot;int&quot;, [&quot;void*&quot;, &quot;int&quot;])
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000484-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000484-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 134</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">import</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">rettype</span>, <span class="ruby-identifier">argtypes</span> = <span class="ruby-keyword kw">nil</span>)
        <span class="ruby-identifier">init_types</span>()
        <span class="ruby-identifier">init_sym</span>()

        <span class="ruby-identifier">rty</span>,<span class="ruby-identifier">_</span>,<span class="ruby-identifier">rdec</span> = <span class="ruby-ivar">@types</span>.<span class="ruby-identifier">encode_return_type</span>(<span class="ruby-identifier">rettype</span>)
        <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">rty</span> )
          <span class="ruby-identifier">raise</span>(<span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;unsupported type: #{rettype}&quot;</span>)
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-identifier">ty</span>,<span class="ruby-identifier">enc</span>,<span class="ruby-identifier">dec</span> = <span class="ruby-identifier">encode_argument_types</span>(<span class="ruby-identifier">argtypes</span>)
        <span class="ruby-identifier">symty</span> = <span class="ruby-identifier">rty</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ty</span>

        <span class="ruby-identifier">sym</span> = <span class="ruby-identifier">symbol</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">symty</span>)

        <span class="ruby-identifier">mname</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">dup</span>
        <span class="ruby-keyword kw">if</span>( <span class="ruby-value">?A</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">mname</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">mname</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">&lt;=</span> <span class="ruby-value">?Z</span> )
          <span class="ruby-identifier">mname</span>[<span class="ruby-value">0</span>,<span class="ruby-value">1</span>] = <span class="ruby-identifier">mname</span>[<span class="ruby-value">0</span>,<span class="ruby-value">1</span>].<span class="ruby-identifier">downcase</span>
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-ivar">@SYM</span>[<span class="ruby-identifier">mname</span>] = [<span class="ruby-identifier">sym</span>,<span class="ruby-identifier">rdec</span>,<span class="ruby-identifier">enc</span>,<span class="ruby-identifier">dec</span>]
        
        <span class="ruby-identifier">module_eval</span> [
          <span class="ruby-node">&quot;def #{mname}(*args)&quot;</span>,
          <span class="ruby-node">&quot;  sym,rdec,enc,dec  = @SYM['#{mname}']&quot;</span>,
          <span class="ruby-value str">&quot;  args = enc.call(args) if enc&quot;</span>,
          <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">$DEBUG</span> )
            <span class="ruby-node">&quot;  p \&quot;[DL] call #{mname} with \#{args.inspect}\&quot;&quot;</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-value str">&quot;&quot;</span>
          <span class="ruby-keyword kw">end</span>,
          <span class="ruby-value str">&quot;  r,rs = sym.call(*args)&quot;</span>,
          <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">$DEBUG</span> )
            <span class="ruby-value str">&quot;  p \&quot;[DL] retval=\#{r.inspect} args=\#{rs.inspect}\&quot;&quot;</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-value str">&quot;&quot;</span>
          <span class="ruby-keyword kw">end</span>,
          <span class="ruby-value str">&quot;  r  = rdec.call(r) if rdec&quot;</span>,
          <span class="ruby-value str">&quot;  rs = dec.call(rs) if dec&quot;</span>,
          <span class="ruby-value str">&quot;  @retval = r&quot;</span>,
          <span class="ruby-value str">&quot;  @args   = rs&quot;</span>,
          <span class="ruby-value str">&quot;  return r&quot;</span>,
          <span class="ruby-value str">&quot;end&quot;</span>,
          <span class="ruby-node">&quot;module_function :#{mname}&quot;</span>,
        ].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\n&quot;</span>)

        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sym</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000475" class="m-detail">
        <a name="M000475"></a>

        <div class="method-heading">
          <a href="#M000475" class="method-signature">
          <span class="method-name">init_sym</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="m-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000475-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000475-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 15</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_sym</span>()
        <span class="ruby-ivar">@SYM</span> <span class="ruby-operator">||=</span> {}
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000474" class="m-detail">
        <a name="M000474"></a>

        <div class="method-heading">
          <a href="#M000474" class="method-signature">
          <span class="method-name">init_types</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="m-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000474-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000474-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 11</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_types</span>()
        <span class="ruby-ivar">@types</span> <span class="ruby-operator">||=</span> <span class="ruby-operator">::</span><span class="ruby-constant">DL</span><span class="ruby-operator">::</span><span class="ruby-constant">Types</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000479" class="m-detail">
        <a name="M000479"></a>

        <div class="method-heading">
          <a href="#M000479" class="method-signature">
          <span class="method-name">parse_cproto</span><span class="method-args">(proto)</span>
          </a>
        </div>
      
        <div class="m-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000479-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000479-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 36</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parse_cproto</span>(<span class="ruby-identifier">proto</span>)
        <span class="ruby-identifier">proto</span> = <span class="ruby-identifier">proto</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/\s+/</span>, <span class="ruby-value str">&quot; &quot;</span>).<span class="ruby-identifier">strip</span>
        <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">proto</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^([\d\w\*_\s]+)\(([\d\w\*_\s\,\[\]]*)\)$/</span>
          <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">$1</span>
          <span class="ruby-identifier">args</span> = <span class="ruby-identifier">$2</span>.<span class="ruby-identifier">strip</span>()
          <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\s+/</span>)
          <span class="ruby-identifier">args</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\s*,\s*/</span>)
          <span class="ruby-identifier">func</span> = <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">pop</span>()
          <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">func</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^\*/</span> )
            <span class="ruby-identifier">func</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/^\*+/</span>,<span class="ruby-value str">&quot;&quot;</span>)
            <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">push</span>(<span class="ruby-value str">&quot;*&quot;</span>)
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-identifier">ret</span>  = <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot; &quot;</span>)
          <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">func</span>, <span class="ruby-identifier">ret</span>, <span class="ruby-identifier">args</span>]
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-identifier">raise</span>(<span class="ruby-constant">RuntimeError</span>,<span class="ruby-node">&quot;can't parse the function prototype: #{proto}&quot;</span>)
        <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000471" class="m-detail">
        <a name="M000471"></a>

        <div class="method-heading">
          <span class="method-name">struct</span><span class="method-args">(contents)</span>
        </div>
      
        <div class="m-description">
          <p>
Alias for <a href="Internal.html#M000470">define_struct</a>
</p>
        </div>
      </div>

      <div id="method-M000483" class="m-detail">
        <a name="M000483"></a>

        <div class="method-heading">
          <a href="#M000483" class="method-signature">
          <span class="method-name">symbol</span><span class="method-args">(name, ty = nil)</span>
          </a>
        </div>
      
        <div class="m-description">
          <p>
example:
</p>
<pre>
 symbol &quot;foo_value&quot;
 symbol &quot;foo_func&quot;, &quot;IIP&quot;
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000483-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000483-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 112</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">symbol</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">ty</span> = <span class="ruby-keyword kw">nil</span>)
        <span class="ruby-identifier">sym</span> = <span class="ruby-keyword kw">nil</span>
        <span class="ruby-ivar">@LIBS</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">lib</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword kw">begin</span>
            <span class="ruby-keyword kw">if</span>( <span class="ruby-identifier">ty</span> )
              <span class="ruby-identifier">sym</span> = <span class="ruby-identifier">lib</span>[<span class="ruby-identifier">name</span>, <span class="ruby-identifier">ty</span>]
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-identifier">sym</span> = <span class="ruby-identifier">lib</span>[<span class="ruby-identifier">name</span>]
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">rescue</span>
            <span class="ruby-keyword kw">next</span>
          <span class="ruby-keyword kw">end</span>
        }
        <span class="ruby-keyword kw">if</span>( <span class="ruby-operator">!</span><span class="ruby-identifier">sym</span> )
          <span class="ruby-identifier">raise</span>(<span class="ruby-constant">RuntimeError</span>, <span class="ruby-node">&quot;can't find the symbol `#{name}'&quot;</span>)
        <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">sym</span>
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000482" class="m-detail">
        <a name="M000482"></a>

        <div class="method-heading">
          <a href="#M000482" class="method-signature">
          <span class="method-name">typealias</span><span class="method-args">(alias_type, ty1, enc1=nil, dec1=nil, ty2=nil, enc2=nil, dec2=nil)</span>
          </a>
        </div>
      
        <div class="m-description">
          <p>
example:
</p>
<pre>
 typealias(&quot;uint&quot;, &quot;unsigned int&quot;)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000482-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000482-source">
<pre>
<span class="ruby-comment cmt"># File dl/lib/dl/import.rb, line 102</span>
      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">typealias</span>(<span class="ruby-identifier">alias_type</span>, <span class="ruby-identifier">ty1</span>, <span class="ruby-identifier">enc1</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">dec1</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">ty2</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">enc2</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">dec2</span>=<span class="ruby-keyword kw">nil</span>)
        <span class="ruby-identifier">init_types</span>()
        <span class="ruby-ivar">@types</span>.<span class="ruby-identifier">typealias</span>(<span class="ruby-identifier">alias_type</span>, <span class="ruby-identifier">ty1</span>, <span class="ruby-identifier">enc1</span>, <span class="ruby-identifier">dec1</span>,
                                     <span class="ruby-identifier">ty2</span><span class="ruby-operator">||</span><span class="ruby-identifier">ty1</span>, <span class="ruby-identifier">enc2</span>, <span class="ruby-identifier">dec2</span>)
      <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000473" class="m-detail">
        <a name="M000473"></a>

        <div class="method-heading">
          <span class="method-name">union</span><span class="method-args">(contents)</span>
        </div>
      
        <div class="m-description">
          <p>
Alias for <a href="Internal.html#M000472">define_union</a>
</p>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>
<div id='credits' style='font-size:smaller' >
 <!-- 0 --> <p> <a href='http://www.ruby-doc.org'>ruby-doc.org</a> is hosted and run  by <a href='http://www.jamesbritt.com'>James Britt</a> and <a href='http://www.happycamperstudios.com'>Happy Camper Studios</a>, a <a href='http://www.happycamperstudios.com'> Ruby application development company in Phoenix, Arizona</a>. Ruby-doc.org was created in 2002 to promote the Ruby language and to help other Ruby hackers.</p>
 <p>Documentation content on ruby-doc.org is provided by <a href='http://www.ruby-doc.org/about'>remarkable members</a> of the Ruby community.</p>
<p>For more information on the Ruby programming language, visit <a href='http://www.ruby-lang.org'>ruby-lang.org</a>.</p>
<p>Want to help improve Ruby's API docs? See <a href='/documentation-guidelines.html'> Ruby Documentation Guidelines</a>.</p>
</div>

</body>
</html>